$(document).ready(function(){$("#add_feed").click(function(){var a=$("#add_feed_txt");if(a.hasClass("selected")){$("#add_feed_hidden").slideUp("fast");a.removeClass("selected");}else{$("#add_feed_hidden").slideDown("fast");a.addClass("selected");}});$("input.error").live("keydown",function(){$(this).removeClass("error");});$("#rss_submit").click(function(){var a=new Array();var b=$("#alias").val();var c=null;if(!b){$("#alias").addClass("error");c=true;}var d=$("#ttl").val();if(!d){$("#ttl").addClass("error");c=true;}var e=$("#url").val();if(!e){$("#url").addClass("error");c=true;}else e=encodeURIComponent(e);if(c)return false;else socket.send("request=add_rss&alias="+b+"&ttl="+d+"&uri="+e);});$(".remote_row").live("click",function(){var a=$(this).next();if(a.hasClass("hidden")){a.slideDown("fast");a.removeClass("hidden");}else{a.slideUp("fast");a.addClass("hidden");}});$(".rss_delete").live("click",function(){var a=$(this).parent().parent().parent().attr("id").split("feed_")[1];if(confirm("Are you sure you want to delete this RSS feed?"))socket.send("request=remove_rss&ID="+a);});$(".rss_enable").live("click",function(){var a=$(this).parent().parent().parent().attr("id").split("feed_")[1];socket.send("request=enable_rss&ID="+a);});$(".rss_disable").live("click",function(){var a=$(this).parent().parent().parent().attr("id").split("feed_")[1];socket.send("request=disable_rss&ID="+a);});$(".add_filter_button").live("click",function(){var a=$(this).parents(".remote_setting").attr("id").split("feed_")[1];var b=new Array();var c=new Array();$(this).closest(".add_filter_div").children().each(function(){if(($(this).hasClass("add_filter")||$(this).hasClass("and_filter"))&&$(this).children("input")[0].value!=="")b.push($(this).children("input")[0].value);else if($(this).hasClass("not_filter")&&$(this).children("input")[0].value!=="")c.push($(this).children("input")[0].value);});b=b.join("||||||");c=c.join("||||||");var d=$(this).closest(".remote_setting").attr("id").split("remote_settings_")[1];if(b!=="")socket.send("request=add_rss_filter&ID="+a+"&positive="+encodeURIComponent(b)+"&negative="+encodeURIComponent(c));});$(".filter_select").live("change",function(){var a=$("<select class='filter_select'><option selected='selected'>---</option><option>and</option><option>not</option></select>");var b=$("<input name='add_filter' class='input_filter' type='text' placeholder='Filter' />");var c=$("<input name='not_filter' class='input_filter' type='text' placeholder='Negative Filter' />");if($(this).val()=="---")if($(this).parent().children("select").length==2){$(this).parent().prev().append($(this));$(this).parent().next().remove();}else $(this).parent().remove();else if($(this).val()=="and"){if($(this).next().length>0){$(this).parent().toggleClass("not_filter and_filter");$(this).next().attr("placeholder","Filter");return;}$(this).parent().after($("<div class='and_filter' />").append(b).append(a));$(this).parent().next().prepend($(this));}else if($(this).val()=="not"){if($(this).next().length>0){$(this).parent().toggleClass("not_filter and_filter");$(this).next().attr("placeholder","Negative Filter");return;}$(this).parent().after($("<div class='not_filter' />").append(c).append(a));$(this).parent().next().prepend($(this));}});$(".filter_group").live("click",function(){var a=$(this).parents(".remote_setting").attr("id").split("feed_")[1];var b=$(".filter_group",$(this).parent()).index($(this));var c=confirm("Are you sure you want to remove this filter?");if(c)socket.send("request=remove_rss_filter&ID="+a+"&index="+b);});});function onOpen(a){console.log("autoSocket opened",a,socket);runInit();}function onMessage(a){if(a.data.indexOf("ERROR")===0){console.log(a.data);socket.close();}else{var b=JSON.parse(a.data);if(b.request=="get_rss"){if(b.error){console.log("ERROR in request "+b.request+": "+b.error);return false;}runPostInit(b.response);}else if(b.request=="add_rss"){if(b.error){alert("ERROR in request "+b.request+": "+b.error);return false;}window.location.replace(window.location);}else if(b.request=="remove_rss"){if(b.error){alert("ERROR in request "+b.request+": "+b.error);return false;}window.location.replace(window.location);}else if(b.request=="enable_rss"){if(b.error){alert("ERROR in request "+b.request+": "+b.error);return false;}socket.send("request=get_rss_single&ID="+b.name);}else if(b.request=="disable_rss"){if(b.error){alert("ERROR in request "+b.request+": "+b.error);return false;}socket.send("request=get_rss_single&ID="+b.name);}else if(b.request=="add_rss_filter"){if(b.error){console.log("ERROR in request "+b.request+": "+b.error);return false;}socket.send("request=get_rss_single&ID="+b.name);}else if(b.request=="remove_rss_filter"){if(b.error){console.log("ERROR in request "+b.request+": "+b.error);return false;}socket.send("request=get_rss_single&ID="+b.name);}else if(b.request=="get_rss_single"){if(b.error){console.log("ERROR in request "+b.request+": "+b.error);return false;}var c=b.name;var d=b.response;$("#feed_id_"+c).replaceWith($(d[0]));var e=$(d[1]);$("#feed_"+c).children().replaceWith(e.children());}else console.log("socket message:",a.data);}}function runInit(){socket.send("request=get_rss");}function runPostInit(a){$("div#temp").remove();var b=$("table#feeds > tbody");for(i=0;i<a.length;i++)b.append($(a[i]));}